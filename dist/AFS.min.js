!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).AFS={})}(this,(function(t){"use strict";function e(t,e){let s;return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),t(...r)}),e)}}t.AFS=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options={containerSelector:".filter-container",itemSelector:".filter-item",filterButtonSelector:".btn-filter",searchInputSelector:".filter-search",counterSelector:".filter-counter",activeClass:"active",hiddenClass:"hidden",animationDuration:300,filterMode:"OR",searchKeys:["title"],debounceTime:300,...t},this.container=document.querySelector(this.options.containerSelector),this.items=document.querySelectorAll(this.options.itemSelector),this.filterButtons=document.querySelectorAll(this.options.filterButtonSelector),this.searchInput=document.querySelector(this.options.searchInputSelector),this.counter=document.querySelector(this.options.counterSelector),this.currentFilters=new Set(["*"]),this.currentSearch="",this.visibleItems=new Set(this.items),this.filterGroups=new Map,this.groupMode="OR",this.init()}init(){this.addStyles(),this.bindEvents(),this.loadFromURL(),this.updateCounter()}addStyles(){const t=`\n            .${this.options.hiddenClass} {\n                display: none !important;\n            }\n\n            ${this.options.itemSelector} {\n                opacity: 1;\n                transform: scale(1);\n                transition: opacity ${this.options.animationDuration}ms ease-out,\n                            transform ${this.options.animationDuration}ms ease-out;\n            }\n\n            ${this.options.filterButtonSelector} {\n                opacity: 0.5;\n                transition: opacity ${this.options.animationDuration}ms ease;\n            }\n\n            ${this.options.filterButtonSelector}.${this.options.activeClass} {\n                opacity: 1;\n            }\n        `,e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}bindEvents(){this.filterButtons.forEach((t=>{t.addEventListener("click",(()=>this.handleFilterClick(t)))})),this.searchInput&&this.searchInput.addEventListener("input",e((t=>{this.search(t.target.value)}),this.options.debounceTime)),window.addEventListener("popstate",(()=>this.loadFromURL()))}handleFilterClick(t){const e=t.dataset.filter;"*"===e?this.resetFilters():this.toggleFilter(e,t),this.filter(),this.updateURL()}resetFilters(){this.filterButtons.forEach((t=>t.classList.remove(this.options.activeClass))),this.currentFilters.clear(),this.currentFilters.add("*"),this.filterButtons[0].classList.add(this.options.activeClass),this.resetCounter()}resetCounter(){this.visibleItems=new Set(this.items),this.updateCounter()}toggleFilter(t,e){if(this.currentFilters.delete("*"),this.filterButtons[0].classList.remove(this.options.activeClass),e.classList.contains(this.options.activeClass)){if(e.classList.remove(this.options.activeClass),this.currentFilters.delete(t),0===this.currentFilters.size)return this.resetFilters(),void window.history.pushState({},"",window.location.pathname)}else e.classList.add(this.options.activeClass),this.currentFilters.add(t)}filter(){const t=()=>{this.visibleItems.clear(),this.items.forEach((t=>{if(this.currentFilters.has("*"))this.showItem(t),this.visibleItems.add(t);else{const e=new Set(t.dataset.categories?.split(" ")||[]);("OR"===this.options.filterMode?this.matchesAnyFilter(e):this.matchesAllFilters(e))?(this.showItem(t),this.visibleItems.add(t)):this.hideItem(t)}}))};0===this.filterGroups.size?t():(this.visibleItems.clear(),this.items.forEach((t=>{if(this.currentFilters.has("*"))this.showItem(t),this.visibleItems.add(t);else{const e=new Set(t.dataset.categories?.split(" ")||[]);this.matchesFilterGroups(e)?(this.showItem(t),this.visibleItems.add(t)):this.hideItem(t)}}))),setTimeout((()=>{this.updateCounter()}),this.options.animationDuration)}addFilterGroup(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OR";try{if(!t||!Array.isArray(e))return console.warn("Invalid group parameters"),!1;const i=s.toUpperCase();return["AND","OR"].includes(i)||(console.warn('Invalid operator. Using default "OR"'),s="OR"),this.filterGroups.set(t,{filters:new Set(e),operator:i}),this.filterGroups.size>0&&(this.updateFiltersFromGroups(),this.filter(),this.updateURL()),!0}catch(t){return console.error("Error adding filter group:",t),!1}}setGroupMode(t){const e=t.toUpperCase();["AND","OR"].includes(e)&&(this.groupMode=e,this.filterGroups.size>0&&this.filter())}removeFilterGroup(t){return!!this.filterGroups.has(t)&&(this.filterGroups.delete(t),0===this.filterGroups.size?this.resetFilters():this.updateFiltersFromGroups(),this.filter(),this.updateURL(),!0)}updateFiltersFromGroups(){if(0!==this.filterGroups.size){this.currentFilters.has("*")||this.currentFilters.clear();for(const t of this.filterGroups.values())t.filters.forEach((t=>{"*"!==t&&this.currentFilters.add(t)}))}}matchesAnyFilter(t){return[...this.currentFilters].some((e=>{const[s,i]=e.split(":");return t.has(`${s}:${i}`)}))}matchesAllFilters(t){return[...this.currentFilters].every((e=>{const[s,i]=e.split(":");return t.has(`${s}:${i}`)}))}showItem(t){this.visibleItems.add(t),t.classList.remove(this.options.hiddenClass),t.style.opacity="0",t.style.transform="scale(0.95)",t.offsetHeight,requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="scale(1)"}))}hideItem(t){t.style.opacity="0",t.style.transform="scale(0.95)",setTimeout((()=>{"0"===t.style.opacity&&(t.classList.add(this.options.hiddenClass),this.visibleItems.delete(t))}),this.options.animationDuration)}search(t){this.currentSearch=t.toLowerCase().trim(),this.items.forEach((t=>{const e=this.options.searchKeys.map((e=>t.dataset[e]||"")).join(" ").toLowerCase();""===this.currentSearch||e.includes(this.currentSearch)?this.showItem(t):this.hideItem(t)})),this.updateURL(),setTimeout((()=>{this.updateCounter()}),this.options.animationDuration)}sortMultiple(t){const e=[...this.items];e.sort(((e,s)=>{for(const i of t){const t=e.dataset[i.key],r=s.dataset[i.key],o="asc"===i.direction?t.localeCompare(r):r.localeCompare(t);if(0!==o)return o}return 0})),e.forEach((t=>this.container.appendChild(t)))}addRangeFilter(t,e,s){this.items.forEach((i=>{const r=parseFloat(i.dataset[t]);r>=e&&r<=s?this.showItem(i):this.hideItem(i)})),setTimeout((()=>{this.updateCounter()}),this.options.animationDuration)}matchesFilterGroups(t){const e=[...this.filterGroups.values()].map((e=>{const s=[...e.filters];return 0===s.length||("OR"===e.operator?s.some((e=>t.has(e))):s.every((e=>t.has(e))))}));return"OR"===this.groupMode?e.some((t=>t)):e.every((t=>t))}updateURL(){if(0===this.currentFilters.size||1===this.currentFilters.size&&this.currentFilters.has("*"))return void window.history.pushState({},"",window.location.pathname);const t=new URLSearchParams(window.location.search);if(this.filterGroups.size>0){for(const[e,s]of this.filterGroups.entries())t.set(`group_${e}`,[...s.filters].join(",")),t.set(`groupOp_${e}`,s.operator.toLowerCase());t.set("groupMode",this.groupMode.toLowerCase())}const e={};for(const t of this.currentFilters)if("*"!==t){const[s,i]=t.split(":");e[s]||(e[s]=new Set),e[s].add(i)}Object.entries(e).forEach((e=>{let[s,i]=e;t.set(s,Array.from(i).join(","))})),this.currentSearch&&t.set("search",this.currentSearch);const s=`${window.location.pathname}${t.toString()?"?"+t.toString():""}`;window.history.pushState({},"",s)}loadFromURL(){const t=new URLSearchParams(window.location.search);this.filterGroups.clear();for(const[e,s]of t.entries())if(e.startsWith("group_")){const i=e.replace("group_",""),r=t.get(`groupOp_${i}`)?.toUpperCase()||"OR",o=s.split(",");this.addFilterGroup(i,o,r)}const e=t.get("groupMode")?.toUpperCase();e&&["AND","OR"].includes(e)&&(this.groupMode=e),this.currentFilters.clear();let s=!1;for(const[e,i]of t.entries())"search"!==e&&(s=!0,i.split(",").forEach((t=>{this.currentFilters.add(`${e}:${t}`)})));s||this.currentFilters.add("*"),this.filterButtons.forEach((t=>{const e=t.dataset.filter;this.currentFilters.has(e)||"*"===e&&this.currentFilters.has("*")?t.classList.add(this.options.activeClass):t.classList.remove(this.options.activeClass)}));const i=t.get("search")||"";this.searchInput&&(this.searchInput.value=i),this.filter(),i&&this.search(i)}updateCounter(){const t=this.items.length,e=this.visibleItems.size;return this.counter&&(this.counter.textContent=`Showing ${e} of ${t}`),{total:t,visible:e}}setAnimationOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options.animationDuration=t.duration||this.options.animationDuration,this.options.animationType=t.type||"ease-out",this.addStyles()}addEventSystem(){this.events={},this.on=(t,e)=>{this.events[t]||(this.events[t]=[]),this.events[t].push(e)},this.emit=(t,e)=>{this.events[t]&&this.events[t].forEach((t=>t(e)))}}setPagination(t){this.pagination={currentPage:1,itemsPerPage:t,totalPages:Math.ceil(this.visibleItems.size/t)},this.updatePagination()}updatePagination(){const t=(this.pagination.currentPage-1)*this.pagination.itemsPerPage,e=t+this.pagination.itemsPerPage;[...this.visibleItems].forEach(((s,i)=>{i>=t&&i<e?this.showItem(s):this.hideItem(s)}))}enableAnalytics(t){this.analyticsCallback=t,this.on("filter",(t=>{this.analyticsCallback({type:"filter",filters:[...this.currentFilters],visibleItems:this.visibleItems.size,timestamp:(new Date).toISOString()})}))}sortWithComparator(t,e){const s=[...this.items];s.sort(((s,i)=>{const r=s.dataset[t],o=i.dataset[t];return e(r,o)})),s.forEach((t=>this.container.appendChild(t)))}setResponsiveOptions(t){window.addEventListener("resize",e((()=>{const e=window.innerWidth;for(const[s,i]of Object.entries(t))if(e<=parseInt(s)){Object.assign(this.options,i),this.filter();break}}),250))}enableKeyboardNavigation(){document.addEventListener("keydown",(t=>{"Enter"===t.key&&document.activeElement.classList.contains(this.options.filterButtonSelector.slice(1))&&document.activeElement.click()}))}exportState(){return{filters:[...this.currentFilters],search:this.currentSearch,mode:this.options.filterMode,timestamp:(new Date).toISOString()}}importState(t){t.filters&&(this.currentFilters=new Set(t.filters),this.currentSearch=t.search||"",this.options.filterMode=t.mode||"OR",this.filter(),this.updateURL())}savePreset(t){const e={filters:[...this.currentFilters],search:this.currentSearch,mode:this.options.filterMode};localStorage.setItem(`afs_preset_${t}`,JSON.stringify(e))}loadPreset(t){const e=JSON.parse(localStorage.getItem(`afs_preset_${t}`));e&&(this.currentFilters=new Set(e.filters),this.currentSearch=e.search,this.options.filterMode=e.mode,this.filter(),this.updateURL())}setLogic(t){if("boolean"==typeof t)return this.options.filterMode=t?"AND":"OR",void this.filter();const e=t.toUpperCase();["OR","AND"].includes(e)&&(this.options.filterMode=e,this.filter())}setFilterMode(t){["OR","AND"].includes(t.toUpperCase())&&(this.options.filterMode=t.toUpperCase(),this.filter())}addFilter(t,e){this.currentFilters.add(`${t}:${e}`),this.filter(),this.updateURL()}removeFilter(t,e){this.currentFilters.delete(`${t}:${e}`),0===this.currentFilters.size&&this.currentFilters.add("*"),this.filter(),this.updateURL()}getActiveFiltersByType(t){return[...this.currentFilters].filter((e=>e.startsWith(`${t}:`))).map((t=>t.split(":")[1]))}clearAllFilters(){this.currentFilters.clear(),this.currentFilters.add("*"),this.filter(),this.updateURL();document.querySelectorAll('input[type="checkbox"]').forEach((t=>{t.classList.contains(this.options.activeClass)&&(t.checked=!1,t.classList.remove(this.options.activeClass))})),this.filterButtons.forEach((t=>{t.classList.remove(this.options.activeClass)}))}}}));
//# sourceMappingURL=AFS.min.js.map
